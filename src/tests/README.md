# اختبارات نظام Multi-Agent للتفريغ السينمائي

## نظرة عامة

هذا المجلد يحتوي على اختبارات شاملة لنظام Three-Read Breakdown System، بما في ذلك:

- **اختبارات البنية الأساسية**: تختبر تهيئة النظام والتكامل بين المكونات
- **اختبارات التكامل مع Python**: تختبر التواصل مع خدمة FastAPI
- **اختبارات الأداء**: تختبر سرعة المعالجة والاستجابة

## تشغيل الاختبارات

### تشغيل جميع الاختبارات
```bash
npm test
```

### تشغيل اختبارات محددة
```bash
# اختبارات البنية الأساسية
npm run test:infrastructure

# اختبارات التكامل مع Python
npm run test:python

# تشغيل الاختبارات مع المراقبة
npm run test:watch

# تشغيل الاختبارات مع تقرير التغطية
npm run test:coverage
```

## متطلبات الاختبار

### 1. متغيرات البيئة
تأكد من وجود ملف `.env` مع المفاتيح التالية:
```env
ANTHROPIC_API_KEY=your_anthropic_key
OPENAI_API_KEY=your_openai_key
# مفاتيح أخرى حسب الحاجة
```

### 2. خدمة Python (اختيارية)
لتشغيل اختبارات التكامل الكاملة، قم بتشغيل خدمة Python:
```bash
# في terminal منفصل
npm run python-service
# أو
python python_brain_service.py
```

إذا لم تكن خدمة Python متاحة، ستعمل الاختبارات في وضع fallback.

## هيكل الاختبارات

### infrastructure.test.ts
- ✅ تهيئة النظام والوكلاء
- ✅ تحميل النماذج والتحقق من توفرها
- ✅ التدفق الكامل للمعالجة
- ✅ معالجة الأخطاء والحالات الاستثنائية
- ✅ اختبارات الأداء الأساسي

### python-integration.test.ts
- ✅ الاتصال مع FastAPI service
- ✅ التحليل المتزامن وغير المتزامن
- ✅ جميع مكونات المعالجة
- ✅ الأنظمة المتقدمة (Revolutionary & Ultimate)
- ✅ معالجة الأخطاء والطلبات غير الصالحة

## نتائج الاختبار المتوقعة

### ✅ حالة النجاح الكامل
- جميع النماذج متاحة (مفاتيح API صحيحة)
- خدمة Python تعمل
- الأنظمة المتقدمة متاحة

### ⚠️ حالة النجاح الجزئي
- بعض النماذج متاحة
- خدمة Python تعمل في وضع fallback
- النظام يعمل بوظائف محدودة

### ❌ حالة الفشل
- لا توجد نماذج متاحة (مفاتيح API مفقودة)
- أخطاء في التكوين الأساسي

## استكشاف الأخطاء

### خطأ: "لا توجد نماذج متاحة"
- تحقق من مفاتيح API في ملف `.env`
- تأكد من صحة المفاتيح وعدم انتهاء صلاحيتها

### خطأ: "Python service unavailable"
- تأكد من تشغيل خدمة Python على المنفذ 8000
- تحقق من تثبيت dependencies Python المطلوبة

### خطأ: "Revolutionary/Ultimate System غير متاح"
- هذا طبيعي إذا لم تكن الأنظمة المتقدمة مثبتة
- النظام سيعمل في وضع fallback

## إضافة اختبارات جديدة

### 1. إنشاء ملف اختبار جديد
```typescript
// src/tests/new-feature.test.ts
import { describe, test, expect } from '@jest/globals';

describe('اختبارات الميزة الجديدة', () => {
  test('يجب أن تعمل الميزة الجديدة', () => {
    // كود الاختبار
  });
});
```

### 2. إضافة script في package.json
```json
{
  "scripts": {
    "test:new-feature": "jest src/tests/new-feature.test.ts"
  }
}
```

## معايير النجاح

### اختبارات البنية الأساسية
- ✅ تهيئة النظام بدون أخطاء
- ✅ إنشاء جميع الوكلاء الأربعة
- ✅ معالجة سيناريو تجريبي بنجاح
- ✅ وقت معالجة أقل من 30 ثانية

### اختبارات التكامل
- ✅ الاتصال بخدمة Python (إذا متاحة)
- ✅ تشغيل جميع مكونات المعالجة
- ✅ معالجة الأخطاء بشكل صحيح
- ✅ إرجاع نتائج منطقية

## الصيانة

- قم بتحديث الاختبارات عند إضافة ميزات جديدة
- تأكد من تشغيل الاختبارات قبل كل commit
- راجع تقارير التغطية بانتظام
- حدث dependencies الاختبار حسب الحاجة