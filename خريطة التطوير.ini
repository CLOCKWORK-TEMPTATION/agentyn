ุจุนุฏ ูุฑุงุกุฉ ุงูููุฏุ ุงููุดููุฉ ุงูุฃุณุงุณูุฉ: **IntelligenceEngine ุบูุฑ ููุชููุฉ** ูุงูููุฏ ูุนุชูุฏ ุนูู Regex ุงูุจุณูุท. ุณุฃูุฏู **ุฃููุงุฑ ุฐููุฉ ูุนูููุฉ** ูููุตูู ููุณุชูู ุงูููู ุงูุฃูู:

---

## **๐ง ุงูุฃููุงุฑ ุงูุซูุฑูุฉ (ุฎุงุฑุฌ ุงูุตูุฏูู)**

### **1. Multi-Pass Architecture (ูุนูุงุฑูุฉ ุซูุงุซูุฉ ุงููุฑุงุญู)**

```
โโโโโโโโโโโโโโโ
โ  Pass 1     โ  Extraction: ุงุณุชุฎุฑุงุฌ ุฎุงู
โ  Raw Parse  โ
โโโโโโโโฌโโโโโโโ
       โ
โโโโโโโโผโโโโโโโ
โ  Pass 2     โ  Enrichment: ุฅุซุฑุงุก ุจุงูุณูุงู
โ  Context    โ
โโโโโโโโฌโโโโโโโ
       โ
โโโโโโโโผโโโโโโโ
โ  Pass 3     โ  Validation: ุชุฏููู ูุชูููุญ
โ  Refinement โ
โโโโโโโโโโโโโโโ
```

---

### **2. Scene Relationship Graph (ุดุจูุฉ ุนูุงูุงุช ุงููุดุงูุฏ)**

**ุงููุจุฏุฃ**: ูู ูุดูุฏ ููุณ ุฌุฒูุฑุฉ ููุนุฒูุฉุ ุจู ุนูุฏุฉ ูู ุดุจูุฉ.

```python
class SceneContextGraph:
    """
    ุจูุงุก ุดุจูุฉ ุนูุงูุงุช ุฐููุฉ ุจูู ุงููุดุงูุฏ
    ุชุชุจุน ุงุณุชูุฑุงุฑูุฉ: ุงูููุงุจุณุ ุงูุฏุนุงุฆูุ ุงูุญุงูุงุช ุงูููุณูุฉ
    """
    def __init__(self):
        self.character_timeline = {}  # ุชุชุจุน ูู ุดุฎุตูุฉ ุนุจุฑ ุงูุฒูู
        self.prop_registry = {}        # ุณุฌู ุงูุฏุนุงุฆู ุงููุชูุฑุฑุฉ
        self.location_history = {}     # ุชุงุฑูุฎ ุงูููุงูุน
    
    def build_continuity_chain(self, scenes):
        """ุจูุงุก ุณูุณูุฉ ุงุณุชูุฑุงุฑูุฉ ุชููุงุฆูุฉ"""
        # ูุซุงู: "ููุงู" ูู ูุดูุฏ 1 ุจููุงุจุณ ููููุฉ
        #        ูู ูุดูุฏ 10 ููุณ ุงููููุฉ โ ุงุณุชูุฑุงุฑ ุชููุงุฆู
```

---

### **3. Semantic Synopsis Generator (ูููุฏ ููุฎุตุงุช ุฏูุงูู)**

**ุงููุดููุฉ ุงูุญุงููุฉ**: ูุณุฎ ุญุฑูู ูู ุงููุต  
**ุงูุญู ุงูุฐูู**: ููุงูุจ ุฏููุงููููุฉ + ุงุณุชุฎุฑุงุฌ ุฏูุงูู

```python
class SynopsisGenerator:
    """ุชูููุฏ ููุฎุตุงุช ุงุญุชุฑุงููุฉ ุจุฏูุงู ูู ุงููุณุฎ"""
    
    TEMPLATES = {
        "dialogue_heavy": "{character1} ู{character2} ูุชุญุงูุฑุงู ุญูู {topic}",
        "action_sequence": "{character} {action_verb} ูู {location}",
        "discovery": "{character} {discover_verb} {object}",
        "transition": "ุงูุชูุงู ุฅูู {location} ูุน {context}"
    }
    
    def generate_synopsis(self, scene_text: str) -> str:
        """
        1. ุชุญุฏูุฏ ููุน ุงููุดูุฏ (Classify scene type)
        2. ุงุณุชุฎุฑุงุฌ ุงูุนูุงุตุฑ ุงูุฃุณุงุณูุฉ (Extract key entities)
        3. ููุก ุงููุงูุจ ุงูููุงุณุจ (Fill template)
        4. ุชูููุญ ุงููุบุฉ (Refine language)
        """
        scene_type = self._classify_scene(scene_text)
        entities = self._extract_semantic_roles(scene_text)
        return self._fill_template(scene_type, entities)
    
    def _classify_scene(self, text: str) -> str:
        """ุชุตููู ุฐูู ุจูุงุกู ุนูู:
        - ูุณุจุฉ ุงูุญูุงุฑ ุฅูู ุงููุตู
        - ูุฌูุฏ ุฃูุนุงู ุญุฑูุฉ
        - ุงููููุงุช ุงูููุชุงุญูุฉ
        """
        dialogue_ratio = len(re.findall(r':\n', text)) / len(text)
        
        if dialogue_ratio > 0.05:
            return "dialogue_heavy"
        elif self._has_action_verbs(text):
            return "action_sequence"
        elif any(verb in text for verb in ["ุชุฌุฏ", "ูุฌุฏ", "ูููุญ"]):
            return "discovery"
        else:
            return "transition"
```

---

### **4. Smart Prop Classifier (ูุตูู ุฏุนุงุฆู ุฐูู)**

**ุงููุดููุฉ**: ุงููุฑุณู ุงููุชุญุฑู โ Vehicles โ  
**ุงูุญู**: ุชุตููู ุฏูุงูู ุจูุงุกู ุนูู ุงูุณูุงู

```python
class PropClassifier:
    """ุชุตููู ุฐูู ููุฃุดูุงุก ุญุณุจ ูุธููุชูุง ูู ุงููุดูุฏ"""
    
    TAXONOMY = {
        "props": {
            "keywords": ["ููุณู", "ูุฃุฎุฐ", "ููุงูู", "ูุญููู", "ุตุบูุฑ"],
            "examples": ["ุธุฑู", "ูุงุชู", "ูุฌูุฉ", "ุญููุจุฉ"]
        },
        "set_dressing": {
            "keywords": ["ูุฌูุณ ุนูู", "ุฃูุงู", "ุฎูู", "ุซุงุจุช"],
            "examples": ["ูุฑุณู", "ูุฑุขุฉ", "ุทุงููุฉ", "ุณุฑูุฑ"]
        },
        "vehicles": {
            "keywords": ["ูุฏุฎู ุฅูู", "ูููุฏ", "ุนุฌูุงุช", "ูุญุฑู"],
            "examples": ["ุณูุงุฑุฉ", "ุฏุฑุงุฌุฉ", "ุทุงุฆุฑุฉ"]
        }
    }
    
    def classify(self, item: str, context: str) -> str:
        """
        ุชุตููู ุฐูู ุจูุงุกู ุนูู:
        1. ุงููููุงุช ุงููุญูุทุฉ
        2. ุงูุฃูุนุงู ุงููุฑุชุจุทุฉ
        3. ุงููุตู ุงูููุฒูุงุฆู
        """
        # ูุซุงู: "ูุฑุณู ูุชุญุฑู" + ุณูุงู "ูุฌูุณ ุนููู" โ Set Dressing
        #        "ูุฑุณู ูุชุญุฑู" + ุณูุงู "ูุฏูุนู" โ ูุฏ ูููู Vehicle
        # ููู ุจุดูู ุนุงู "ูุฑุณู ูุชุญุฑู ุทุจู" โ Props (ุฃุฏุงุฉ ุทุจูุฉ)
        
        if "ูุฑุณู ูุชุญุฑู" in item:
            # ุชุญููู ุงูุณูุงู
            if any(v in context for v in ["ุทุจู", "ูุฑูุถ", "ูุฌูุณ"]):
                return "props"  # ุฃุฏุงุฉ ุทุจูุฉ
            elif "ูุฏูุน" in context:
                return "set_dressing"  # ุฌุฒุก ูู ุงูุฏูููุฑ
        
        # ููุทู ุนุงู
        for category, rules in self.TAXONOMY.items():
            if any(kw in context.lower() for kw in rules["keywords"]):
                return category
```

---

### **5. Character Wardrobe Inference Engine (ูุญุฑู ุงุณุชูุชุงุฌ ุงูุฃุฒูุงุก)**

**ุงูููุฑุฉ**: ุจูุงุก "ุฎุฑูุทุฉ ุฐููุฉ" ููุฃุฒูุงุก ูู ุงููุตู ุงูุณุฑุฏู

```python
class WardrobeInferenceEngine:
    """ุงุณุชูุชุงุฌ ุงูุฃุฒูุงุก ูู ุงููุตู ูุงูุณูุงู"""
    
    DESCRIPTOR_MAPPING = {
        "ุตุฑุงูุฉ": "ููุงุจุณ ุฑุณููุฉ ูุญุงูุธุฉ (ุจุฏูุฉ/ุชุงููุฑ)",
        "ุนูููุฉ ุจุดุฏุฉ": "ุณุชุงูู ุนููู ุณุงุฏุฉ + ุญุฏ ุฃุฏูู ุฅูุณุณูุงุฑุงุช",
        "ูุณุงูุฉ": "ูููุต ุฃููู + ุฌุงููุช ุฃู ุจุฏูุฉ ุบูุฑ ุฑุณููุฉ",
        "ููุงุฑ": "ุจุฏูุฉ ุฑุณููุฉ ูุงุฎุฑุฉ",
        "ุงุญุจุงุท": "ููุงุจุณ ูุฑุชุจุฉ ููู ุจุญุงูุฉ ููุณูุฉ ูุถุทุฑุจุฉ"
    }
    
    TIME_LOCATION_RULES = {
        ("ููู", "ููุฒู"): "ููุงุจุณ ููุฒููุฉ / ุจูุฌุงูุฉ ุฑุงููุฉ",
        ("ููุงุฑ", "ููุชุจ"): "ุฒู ุฑุณูู ููุงุณุจ ููุนูู",
        ("ููุงุฑ", "ุฎุงุฑุฌู"): "ููุงุจุณ ููููุฉ casual"
    }
    
    def infer_wardrobe(self, character: str, description: str, 
                      time: str, location: str) -> str:
        """
        ุงุณุชูุชุงุฌ ูุชุนุฏุฏ ุงููุณุชููุงุช:
        1. ูู ุงููุตู ุงููุตู ุงููุจุงุดุฑ
        2. ูู ุงูุณูุงู ุงูุฒูุงูู/ุงูููุงูู
        3. ูู ุงูุญุงูุฉ ุงูููุณูุฉ
        4. ูู ุงููููุฉ/ุงูุทุจูุฉ ุงูุงุฌุชูุงุนูุฉ
        """
        wardrobe = []
        
        # Level 1: Direct description
        for descriptor, clothing in self.DESCRIPTOR_MAPPING.items():
            if descriptor in description:
                wardrobe.append(clothing)
        
        # Level 2: Context rules
        context_key = (time, self._extract_location_type(location))
        if context_key in self.TIME_LOCATION_RULES:
            wardrobe.append(self.TIME_LOCATION_RULES[context_key])
        
        # Level 3: Character profession (ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช)
        if character == "ูุฏุญุช" and "ูุจุงุญุซ" in location:
            wardrobe.append("ุจุฏูุฉ ุฑุณููุฉ + ุณูุงุญ ุฌุงูุจู")
        
        return " | ".join(wardrobe) if wardrobe else "ุญุณุจ ุงูุณูุงู"
```

---

### **6. Cinematic Pattern Recognition (ุชูููุฒ ุงูุฃููุงุท ุงูุฅุฎุฑุงุฌูุฉ)**

```python
class CinematicAnalyzer:
    """ุชุญููู ุฃููุงุท ุฅุฎุฑุงุฌูุฉ ุดุงุฆุนุฉ ูุงูุชุฑุงุญ ููุงุญุธุงุช"""
    
    PATTERNS = {
        "power_confrontation": {
            "triggers": ["ูุฌูุณ.*ุงูุงู", "ููุชุจ", "ุฑุฌู.*ูุจุฏู"],
            "note": "ูุดูุฏ ููุงุฌูุฉ: ุถุจุท ุจูููููุฌ ูุจุฑุฒ ุตุฑุงุน ุงูุณูุทุฉ"
        },
        "discovery": {
            "triggers": ["ูุฌุฏ", "ูููุญ", "ุชูุน ุนูููู"],
            "note": "ูุดูุฏ ุงูุชุดุงู: ุงูุชุฑููุฒ ุนูู ุฑูุฃูุดู ุงูุดุฎุตูุฉ"
        },
        "phone_conversation": {
            "triggers": ["ูุงุชู ูุญููู", "ูุชุญุฏุซ ูู"],
            "note": "ุชุตููุฑ ุฌุงูุจ ูุงุญุฏ ูู ุงูููุงููุฉ"
        },
        "music_cue": {
            "triggers": ["ูุบูู", "ุตูุช.*ุฏูุงุจ", "ูุงุณูุช"],
            "note": "ููุณููู ุชุตููุฑูุฉ: ุชุฃููุฏ ุญููู ุงูุชุดุบูู"
        }
    }
    
    def analyze_scene(self, scene_text: str) -> str:
        """ุงูุชุฑุงุญ ููุงุญุธุฉ ุฅุฎุฑุงุฌูุฉ ุจูุงุกู ุนูู ููุท ุงููุดูุฏ"""
        for pattern_name, config in self.PATTERNS.items():
            if all(re.search(t, scene_text) for t in config["triggers"]):
                return config["note"]
        
        return "ูุฑุงุฌุนุฉ ุงูุฑุงููุฑุงุช (Continuity)"
```

---

### **7. LLM-Assisted Refinement (ุชูููุญ ุจูุณุงุนุฏุฉ LLM)**

**ุงูููุฑุฉ ุงูุซูุฑูุฉ**: ุงุณุชุฎุฏุงู Claude/GPT ูู "ูุญุฑุฑ ุจุดุฑู" ุฏุงุฎู ุงูููุฏ

```python
class LLMRefiner:
    """ุงุณุชุฎุฏุงู LLM ูุชูููุญ ุงููุฎุฑุฌุงุช"""
    
    def refine_synopsis(self, raw_synopsis: str, scene_text: str) -> str:
        """
        ุงุณุชุฎุฏุงู Claude API ูุฅุนุงุฏุฉ ุตูุงุบุฉ ุงูููุฎุต
        
        Prompt:
        "ุฃุนุฏ ุตูุงุบุฉ ูุฐุง ุงูููุฎุต ููููู ุงุญุชุฑุงููุงู ูููุฌุฒุงู (2-3 ุฌูู):
        ุงููุต ุงูุฃุตูู: {scene_text}
        ุงูููุฎุต ุงูุญุงูู: {raw_synopsis}
        
        ุงููุทููุจ: ููุฎุต ูุฑูุฒ ุนูู ุงูุญุฏุซ ุงูุฑุฆูุณู ุฏูู ุชูุงุตูู ุฒุงุฆุฏุฉ"
        """
        # Integration with Anthropic API
        pass
    
    def suggest_wardrobe(self, character_desc: str) -> str:
        """
        Prompt:
        "ุจูุงุกู ุนูู ูุฐุง ุงููุตูุ ุงูุชุฑุญ ุฃุฒูุงุก ุณูููุงุฆูุฉ ููุงุณุจุฉ:
        {character_desc}
        
        ุงูุฅุฌุงุจุฉ ูุฌุจ ุฃู ุชููู: [ููุน ุงูููุงุจุณ] + [ูุณุชูู ุงูุฑุณููุฉ] + [ุชูุงุตูู ูุญุฏุฏุฉ]"
        """
        pass
```

---

## **๐ฏ ุงูุญู ุงูุนููู ุงูููุชุฑุญ**

ุณุฃุตูู **IntelligenceEngine ูุชุทูุฑุฉ** ุชุฌูุน ูู ูุฐู ุงูุฃููุงุฑ:

```python
class IntelligenceEngine:
    """ุงููุญุฑู ุงูุฐูู ุงูุดุงูู"""
    
    def __init__(self):
        self.synopsis_gen = SynopsisGenerator()
        self.prop_classifier = PropClassifier()
        self.wardrobe_engine = WardrobeInferenceEngine()
        self.cinematic_analyzer = CinematicAnalyzer()
        self.context_graph = SceneContextGraph()
        # ุงุฎุชูุงุฑู: self.llm_refiner = LLMRefiner()
    
    def enrich_scene(self, scene: SceneBreakdown, scene_text: str):
        """
        ุฅุซุฑุงุก ุดุงูู ูู 7 ุฎุทูุงุช:
        1. ุชูููุฏ ููุฎุต ุงุญุชุฑุงูู
        2. ุชุตููู ุงูุฏุนุงุฆู ุจุฐูุงุก
        3. ุงุณุชูุชุงุฌ ุงูุฃุฒูุงุก
        4. ุชุญููู ุงูุงุณุชูุฑุงุฑูุฉ
        5. ูุดู ุงูุชูุจููุงุช ุงููุงููููุฉ
        6. ุงูุชุฑุงุญ ููุงุญุธุงุช ุฅุฎุฑุงุฌูุฉ
        7. (ุงุฎุชูุงุฑู) ุชูููุญ ุจู LLM
        """
```

---
